# requires helm-kush plugin from https://github.com/oneilsh/helm-kush

# example deployment:
# helm kush upgrade grafana ../charts/grafana --kush-interpolate --install --values <thisfile>

# uninstall: helm delete grafana -n cluster-tools 

clusterHostname: example-cluster.datasci.oregonstate.edu
kubeContext: example-cluster
adminPassword: admin

# this is needed because the chart looks for .Values.admin.existingSecret
# in an if-block check, but if admin is missing it will throw an error
# about existingSecret, see https://github.com/helm/helm/issues/8026
admin:
  existingSecret: ""

createNamespace: cluster-tools


ingress:
  enabled: true
  ingressClassName: nginx
  annotations:
    nginx.org/mergeable-ingress-type: "minion"
    nginx.org/websocket-services: "grafana"
  path: /<%= $RELEASE_NAME %>/
  hosts:
    - <%= $(index clusterHostname "") %>

persistence:
  enabled: true

grafana.ini:
  server:
    domain: <%= $(index clusterHostname "") %>
    root_url: https://<%= $(index clusterHostname "") %>/<%= $RELEASE_NAME %>
    serve_from_sub_path: true

nodeSelector:
  nodegroup-role: clustertools 

datasources:
  datasources.yaml:
    apiVersion: 1
    datasources:
    - name: Prometheus
      type: prometheus
      url: http://prometheus-server.<%= $HELM_NAMESPACE %>.svc.cluster.local
      access: proxy
      isDefault: true  

plugins:
- digrich-bubblechart-panel
- grafana-clock-panel
- neocat-cal-heatmap-panel
- petrslavotinek-carpetplot-panel
- mtanda-histogram-panel
- michaeldmoore-multistat-panel
- natel-plotly-panel
- mxswat-separator-panel
- grafana-kubernetes-app
